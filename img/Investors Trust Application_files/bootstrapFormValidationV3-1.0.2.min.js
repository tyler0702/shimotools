//------------------------------------
// Bootstrap Form Validation (for Bootstrap 3.x)
// Ver: 1.0.2
//
// Author: ENTEREAL LLP
// URL: http://www.entereal.co.jp/
//------------------------------------

(function(e){function n(t){var n="true";var i="false";var s=t.parents(".form-group");var o=s.find(".alert-box");s.find("[valCheck]").each(function(){t=e(this);if(t.is("[valCheck*=required]:hidden")){s.removeClass("has-error")}else if(t.is("[valCheck*=required]:visible")){var u="";if(t.is('[valCheck*=" check"]')||t.is('[valCheck*="groupcheck"]')){u=e('input[name="'+t.attr("name")+'"]:checked').val()}else if(t.is('[valCheck*="select"]')){if(t.find(":selected").attr("value")===undefined){u=""}else{u=t.val()}}else{u=t.val()}if(i=="true"||u==""||u===undefined){s.addClass("has-error");o.find(".alert-msg").hide();o.find(".required-msg").show();n="false"}}if(t.is('[valCheck*="file"]')&&t.val()!==undefined&&t.val()!==""){var a=t.attr("valCheck").replace("required ","").replace("file ","").split(" ");var f="false";for(var l=0;l<a.length;l++){var c=new RegExp(a[l],"i");if(t.val().match(c)){f="true"}}if(f!=="true"){s.addClass("has-error");o.find(".alert-msg").hide();o.find(".invalid-msg").show();n=f}}if(n=="true"){n=r(t)}});return n}function r(t){var n="true";var r=t.val();var s=t.parents(".form-group");var o=s.find(".alert-box");if(!t.is("[valCheck*=select]")){r=r.replace(/[\s　]+/g,"　");r=r.replace(/(^　+)|(　+$)/g,"");r=i(r)}if(t.is("[valCheck*=file]")){return true}if(t.is("[valCheck*=text]")){r=r.replace(/[-ー－―ｰ]+/g,"ー");while(r.match(/([\w]+)(ー)/)){r=r.replace(RegExp.$1+RegExp.$2,RegExp.$1+"-")}}if(t.is("[valCheck*=kana]")){r=r.replace(/[-ー－―ｰ]+/g,"ー");r=r.replace(/ーー/g,"ー");if(!r.match(/^[ァ-ヶー]*$/)){n="invalid"}}if(t.is("[valCheck*=number]")){if(r.match(/^\d+$/)){r=r-0+""}else{r="";n="invalid"}}if(t.is("[valCheck*=zip]")){if(r.replace(/[-ー－―ｰ]+/g,"").match(/([\d]{3})([\d]{4})/)){r=RegExp.$1+"-"+RegExp.$2}else{r=r.replace(/[-ー－―ｰ]+/g,"-");n="invalid"}}if(t.is("[valCheck*=tel]")){r=r.replace(/[-ー－―ｰ]+/g,"-");if(r.replace(/-/g,"").match(/^0[\d]{9}$/)&&(r.length==10||r.length==11||r.length==12)||r.replace(/-/g,"").match(/^0[\d]{10}$/)&&(r.length==11||r.length==12||r.length==13)){var u=r.replace(/-/g,"").length;var a=r.replace(/-/g,"").substr(0,2);var f=r.replace(/-/g,"").substr(0,3);var l=r.replace(/-/g,"").substr(0,4);var c=r.replace(/-/g,"").substr(0,5);if(u==11){if(f=="050"||f=="070"||f=="080"||f=="090"){r.replace(/[-ー－―ｰ]+/g,"").match(/(\d{3})(\d{4})(\d{4})/);r=RegExp.$1+"-"+RegExp.$2+"-"+RegExp.$3}else{n="invalid"}}else if(u==10){if(l=="0120"||l=="0800"){r.replace(/[-ー－―ｰ]+/g,"").match(/(\d{4})(\d{3})(\d{3})/);r=RegExp.$1+"-"+RegExp.$2+"-"+RegExp.$3}else if(a=="03"||a=="06"||l=="0420"||l=="0429"||c=="04700"||c=="04709"||l=="0471"){r.replace(/[-ー－―ｰ]+/g,"").match(/(\d{2})(\d{4})(\d{4})/);r=RegExp.$1+"-"+RegExp.$2+"-"+RegExp.$3}else{if(r.match(/\d{10}/)||!r.match(/-\d{4}$/)||!r.match(/\\d{2,5}-/)){r.replace(/[-ー－―ｰ]+/g,"").match(/(\d{3})(\d{3})(\d{4})/);r=RegExp.$1+"-"+RegExp.$2+"-"+RegExp.$3}}}}else{n="invalid"}}if(t.is("[valCheck*=email]")){if(!t.val().match(/^[A-Za-z0-9]+[\w\._-]+@[\w\.-]+\.\w{2,}$/)){n="invalid"}}if(t.is("[valCheck*=url]")){if(!t.val().match(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/)){n="invalid"}}if(t.is("[valCheck*=passwd]")){var h=0;var p=999;var d=t.attr("valCheck").replace("required","").replace("passwd_","").replace("passwd","").replace(" ","").split("-");if(d.length>1){if(d[0].match(/^\d+$/)){h=d[0]-0}if(d[1].match(/^\d+$/)){p=d[1]-0}if(t.is("[valCheck*=required]")){h=h==0?1:h}if(t.val().length<h){n="short"}else if(t.val().length>p){n="long"}}}if(t.is("[valCheck*=groupcheck]")){var h=0;var p=999;var v=t.attr("valCheck").replace("required","").replace("groupcheck_","").replace("groupcheck","").replace(" ","").split("-");if(v.length>1){if(v[0].match(/^\d+$/)){h=v[0]-0}if(v[1].match(/^\d+$/)){p=v[1]-0}if(t.is("[valCheck*=required]")){h=h==0?1:h}var m=s.find("input[name="+t.attr("name")+"]:checked").length;if(m<h){n="short"}else if(m>p){n="long"}}}if(t.is("[valCheck*=retype]")){s.find("input[name="+t.attr("name")+"]").each(function(){if(e(this).val()!=t.val()){n="not-matched"}});if(n=="true"&&o.find(".invalid-msg:visible").length>0){return"false"}}t.val(r);if(t.is("[valCheck*=required]")&&r==""){s.addClass("has-error");o.find(".alert-msg").hide();o.find(".required-msg").show();return"false"}if(n!=="true"){s.addClass("has-error");o.find(".alert-msg").hide();o.find("."+n+"-msg").show()}else{s.removeClass("has-error");o.find(".alert-msg").hide()}return n}function i(e){e=e.replace(/[Ａ-Ｚａ-ｚ０-９]/g,function(e){return String.fromCharCode(e.charCodeAt(0)-65248)});return e}var t="";e.fn.bootstrapFormValidation=function(r){var i=e.extend({checkRealtime:"true",alertMsgClass:"alert-msg",addIcon:"true",warningIcon:"glyphicon-remove",requiredMessage:"必須項目",invalidMessage:"不正形式",inputTooShortMessage:"入力/選択 不足",inputTooLongMessage:"入力/選択 超過",notMatchedMessage:"不一致"},r);var s=this;t=i.alertMsgClass;s.each(function(){var r=e('<div class="alert-box col-sm-2"></div>');var o=e('<span class="glyphicon form-control-feedback"></span>').addClass(i.warningIcon);var u=e('<p class="required-msg"></p>').addClass(t).html(i.requiredMessage);var a=e('<p class="invalid-msg"></p>').addClass(t).html(i.invalidMessage);var f=e('<p class="short-msg"></p>').addClass(t).html(i.inputTooShortMessage);var l=e('<p class="long-msg"></p>').addClass(t).html(i.inputTooLongMessage);var c=e('<p class="not-matched-msg"></p>').addClass(t).html(i.notMatchedMessage);s.find(".form-group [valCheck]").each(function(){var h=e(this).parents(".form-group");if(h.find(".alert-box").length==0){h.append(r.clone())}var p=h.find(".alert-box");if(i.addIcon=="true"){if(e(this).is("[type=text]")||e(this).is("[type=number]")||e(this).is("[type=email]")||e(this).is("[type=password]")||e(this).is("select")||e(this).is("textarea")){if(!e(this).next().is(".form-control-feedback")&&!e(this).next().is(".input-group-addon")&&!e(this).next().is(".input-group-btn")){h.addClass("has-feedback");e(this).after(o.clone());if(e(this).parents(".input-group").length>0){e(this).css("border-top-right-radius","4px").css("border-bottom-right-radius","4px")}}}}if(e(this).is("[valCheck*=required]")){if(p.find(".required-msg").length==0){p.append(u.clone())}}if(e(this).is("[valCheck*=zip]")||e(this).is("[valCheck*=tel]")||e(this).is("[valCheck*=email]")||e(this).is("[valCheck*=url]")||e(this).is("[valCheck*=number]")||e(this).is("[valCheck*=kana]")||e(this).is("[valCheck*=file]")||e(this).is("[valCheck*=length]")){if(p.find(".invalid-msg").length==0){p.append(a.clone())}}if(e(this).is("[valCheck*=passwd]")||e(this).is("[valCheck*=groupcheck]")){if(p.find(".short-msg").length==0){p.append(f.clone())}if(p.find(".long-msg").length==0){p.append(l.clone())}}if(e(this).is("[valCheck*=retype]")){if(p.find(".not-matched-msg").length==0){p.append(c.clone())}}if(i.checkRealtime=="true"){e(this).on("blur.valiCheckRealtime",function(){n(e(this))})}if(e(this).is("[valCheck*=submit]")){e(this).off("blur.valiCheckRealtime");var d=e(this).attr("onclick")===undefined?"":e(this).attr("onclick");e(this).removeAttr("onclick");e(this).on("click.valiSubmit",function(){s.find(".form-group [valCheck]").not("button").each(function(){n(e(this))});var r=s.find("."+t+":visible").length;console.log("エラー項目数："+r);if(r==0){if(d!=""){func=new Function("return "+d);func()}}else{return false;s.find(".has-error:eq(0)").find("input, select, textarea")[0].focus()}})}})});return this}})(jQuery)
